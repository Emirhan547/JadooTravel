

<section class="pt-5 pb-9 bg-light" id="ai-recommendations">
    <div class="container">
        <div class="mb-7 text-center">
            <h5 class="text-secondary">AI Destekli Rehber</h5>
            <h3 class="fs-xl-10 fs-lg-8 fs-7 fw-bold font-cursive text-capitalize">
                Nereye Gitmek İstiyorsunuz?
            </h3>
            <p class="text-muted">Yapay zeka destekli seyahat asistanımız size özel öneriler sunuyor</p>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Search Card -->
                <div class="card shadow-lg border-0 mb-4">
                    <div class="card-body p-4">
                        <form id="aiRecommendationForm">
                            <div class="row g-3 align-items-center">
                                <div class="col-md-9">
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-white border-end-0">
                                            <i class="fas fa-map-marker-alt text-primary"></i>
                                        </span>
                                        <input type="text"
                                               class="form-control border-start-0 ps-0"
                                               id="cityCountryInput"
                                               placeholder="Örn: Paris, İstanbul, Tokyo..."
                                               required>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <button type="submit" class="btn btn-primary btn-lg w-100">
                                        <i class="fas fa-search me-2"></i>
                                        Keşfet
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loadingState" class="text-center py-5" style="display: none;">
                    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                        <span class="visually-hidden">Yükleniyor...</span>
                    </div>
                    <p class="mt-3 text-muted">Yapay zeka öneriler hazırlıyor...</p>
                </div>

                <!-- Error State -->
                <div id="errorState" class="alert alert-danger" style="display: none;" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <span id="errorMessage"></span>
                </div>

                <!-- Results Card -->
                <div id="resultsCard" class="card shadow-lg border-0" style="display: none;">
                    <div class="card-header bg-gradient text-white py-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <h4 class="mb-0">
                            <i class="fas fa-map-marked-alt me-2"></i>
                            <span id="resultCityName"></span> için Öneriler
                        </h4>
                    </div>
                    <div class="card-body p-4">
                        <div id="recommendationsContent" style="white-space: pre-wrap; line-height: 1.8; font-size: 1.05rem;">
                        </div>
                    </div>
                    <div class="card-footer bg-light text-center py-3">
                        <button class="btn btn-outline-primary" onclick="resetForm()">
                            <i class="fas fa-redo me-2"></i>
                            Yeni Arama Yap
                        </button>
                    </div>
                </div>

                <!-- Popular Destinations Quick Links -->
                <div class="mt-5">
                    <p class="text-center text-muted mb-3">
                        <i class="fas fa-fire text-danger me-2"></i>
                        Popüler Destinasyonlar
                    </p>
                    <div class="d-flex flex-wrap justify-content-center gap-2">
                        <button class="btn btn-outline-secondary btn-sm quick-search" data-city="Paris, Fransa">
                            🇫🇷 Paris
                        </button>
                        <button class="btn btn-outline-secondary btn-sm quick-search" data-city="İstanbul, Türkiye">
                            🇹🇷 İstanbul
                        </button>
                        <button class="btn btn-outline-secondary btn-sm quick-search" data-city="Tokyo, Japonya">
                            🇯🇵 Tokyo
                        </button>
                        <button class="btn btn-outline-secondary btn-sm quick-search" data-city="New York, ABD">
                            🇺🇸 New York
                        </button>
                        <button class="btn btn-outline-secondary btn-sm quick-search" data-city="Roma, İtalya">
                            🇮🇹 Roma
                        </button>
                        <button class="btn btn-outline-secondary btn-sm quick-search" data-city="Barcelona, İspanya">
                            🇪🇸 Barcelona
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .input-group-text {
        border-right: 0 !important;
    }

    .form-control:focus {
        border-color: #ced4da;
        box-shadow: none;
    }

    .quick-search {
        transition: all 0.3s ease;
    }

        .quick-search:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

    #recommendationsContent {
        max-height: 600px;
        overflow-y: auto;
    }

        #recommendationsContent::-webkit-scrollbar {
            width: 8px;
        }

        #recommendationsContent::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        #recommendationsContent::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

            #recommendationsContent::-webkit-scrollbar-thumb:hover {
                background: #555;
            }
</style>

<script>
    // Form submit handler
    document.getElementById('aiRecommendationForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const cityCountry = document.getElementById('cityCountryInput').value.trim();

        if (!cityCountry) {
            showError('Lütfen bir şehir veya ülke adı girin.');
            return;
        }

        await getRecommendations(cityCountry);
    });

    // Quick search buttons
    document.querySelectorAll('.quick-search').forEach(button => {
        button.addEventListener('click', async function() {
            const city = this.getAttribute('data-city');
            document.getElementById('cityCountryInput').value = city;
            await getRecommendations(city);
        });
    });

    // Get recommendations from API
    async function getRecommendations(cityCountry) {
        // Hide previous results
        document.getElementById('resultsCard').style.display = 'none';
        document.getElementById('errorState').style.display = 'none';

        // Show loading
        document.getElementById('loadingState').style.display = 'block';

        try {
            const response = await fetch('/api/recommendations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ cityCountry: cityCountry })
            });

            if (!response.ok) {
                throw new Error('Sunucu hatası');
            }

            const data = await response.json();

            // Hide loading
            document.getElementById('loadingState').style.display = 'none';

            // Show results
            document.getElementById('resultCityName').textContent = cityCountry;
            document.getElementById('recommendationsContent').textContent = data.recommendations;
            document.getElementById('resultsCard').style.display = 'block';

            // Smooth scroll to results
            document.getElementById('resultsCard').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });

        } catch (error) {
            console.error('Error:', error);
            document.getElementById('loadingState').style.display = 'none';
            showError('Öneriler alınırken bir hata oluştu. Lütfen tekrar deneyin.');
        }
    }

    // Show error message
    function showError(message) {
        document.getElementById('errorMessage').textContent = message;
        document.getElementById('errorState').style.display = 'block';

        // Auto hide after 5 seconds
        setTimeout(() => {
            document.getElementById('errorState').style.display = 'none';
        }, 5000);
    }

    // Reset form
    function resetForm() {
        document.getElementById('cityCountryInput').value = '';
        document.getElementById('resultsCard').style.display = 'none';
        document.getElementById('cityCountryInput').focus();
    }
</script>